<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StoreCollect Thank You</title>
<style>
  body { font-family: Arial; text-align:center; padding:20px; background:#f3f3f3; }
  .container { max-width:600px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
  table { width:100%; border-collapse: collapse; margin-bottom:20px; }
  th, td { border-bottom:1px solid #ccc; padding:8px; text-align:left; }
  h2, h3 { margin-bottom:12px; }
  .img{ max-width: 600px; height: 200px; object-fit:contain; margin: 0 auto 20px auto;}
  .container2{text-align: left;}
</style>
</head>
<body>
<div class="container">
  <h2>Thank you, <span id="customerName"></span>!</h2>
  <p>Your order has been successfully placed. âœ…</p>

  <h3>Your Order:</h3>
  <table id="cartTable">
    <thead><tr><th>Product</th><th>Qty</th><th>Price</th></tr></thead>
    <tbody></tbody>
  </table>
  <div class="container2">
    <p><strong>Shipping Cost:</strong> R<span id="shippingCost"></span></p>
  </div>
  <h3>Total: R<span id="grandTotal"></span></h3>
</div>

<img src="ThankLogo.jpg" class="img">

<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);

  const name = params.get("name") || "Customer";
  const total = params.get("total") || 0;
  const shipping = params.get("shipping") || 0;
  const cart = JSON.parse(params.get("cart") || "[]");

  document.getElementById("customerName").textContent = name;
  document.getElementById("grandTotal").textContent = total;
  document.getElementById("shippingCost").textContent = shipping;

  const tbody = document.querySelector("#cartTable tbody");
  cart.forEach(item => {
    const row = document.createElement("tr");
    const tprice = item.price * item.qty;
    row.innerHTML = `<td>${item.title}</td><td>${item.qty}</td><td>R${tprice.toFixed(2)}</td>`;
    tbody.appendChild(row);
  });

  // Optional: Post again to Shopify webhook for extra safety
  fetch("/api/shopify-webhook", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ customerName: name, total, shipping, cart })
  })
  .then(res => res.json())
  .then(data => console.log("Shopify webhook response:", data))
  .catch(err => console.error("Shopify webhook error:", err));
});
</script>
</body>
</html>
