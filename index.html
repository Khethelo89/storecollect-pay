<!-- ... everything in your <head> stays the same ... -->

<script src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"></script>
<script>
  const yoco = new window.YocoSDK({
    publicKey: 'pk_test_a3abafa43ol0djK02ad4' // Your actual Yoco public key
  });

  function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      product: params.get('product') || 'StoreCollect.net Payment',
      amount: parseInt(params.get('amount')) || 5500 // default to R55.00 in cents
    };
  }

  const { product, amount } = getQueryParams();

  document.getElementById('productDesc').textContent = product;
  document.getElementById('productAmount').textContent = 'Amount to pay: R ' + (amount / 100).toFixed(2);

  document.getElementById('payBtn').addEventListener('click', function () {
    const name = document.getElementById('customerName').value.trim();
    const email = document.getElementById('customerEmail').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();

    if (!name || !email || !phone) {
      alert("Please fill in all the fields.");
      return;
    }

    yoco.showPopup({
      amountInCents: amount,
      currency: 'ZAR',
      name: product,
      description: `Payment for ${product}`,
      callback: function (result) {
        if (result.error) {
          alert("Payment failed: " + result.error.message);
        } else {
          // Send payment & order details to Make.com webhook
          fetch("https://hook.eu2.make.com/uw1b0jdqmeuld8g0cvwkleuuh3wxr7u5", { // Your webhook URL
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              product_name: product,
              quantity: 1,
              price: (amount / 100).toFixed(2),
              currency: 'ZAR',
              customer_name: name,
              customer_email: email,
              customer_phone: phone,
              payment_id: result.id, // Yoco transaction ID
              financial_status: "paid"
            })
          })
          .then(response => response.text())
          .then(data => {
            alert("✅ Payment successful! Your Shopify order is being created.");
          })
          .catch(err => {
            alert("⚠ Payment succeeded but sending order failed: " + err);
          });
        }
      }
    });
  });
    </script>
